//Basic handler for the database:
const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('database.db', (err)=> {
    if (err) {
        console.error('There was an error connecting to the Database:', err.message);
    }
    else {
        console.log('Connected successfully to the Database.');
    }
});

//Now to create the tables:
const RestaurantsTable = `CREATE TABLE IF NOT EXISTS RESTAURANTS(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NAME TEXT NOT NULL,
    LOCATION TEXT NOT NULL,
    AVAILABILITY TEXT NOT NULL,
    DATE TEXT NOT NULL,
    CATEGORIES TEXT NOT NULL)`;

const UsersTable = `CREATE TABLE IF NOT EXISTS USERS(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NAME TEXT NOT NULL,
    PASSWORD TEXT NOT NULL,
    EMAIL TEXT UNIQUE NOT NULL,
    ADMIN INT)`;

const ReservationTable = `CREATE TABLE IF NOT EXISTS RESERVATIONS(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INT,
    RESTAURANT_ID INT,
    GUESTS INT NOT NULL,
    STATUS TEXT NOT NULL, 
    FOREIGN KEY (USER_ID) REFERENCES USERS(ID),
    FOREIGN KEY (RESTAURANT_ID) REFERENCES RESTAURANTS(ID))`;

const MenuTable = `CREATE TABLE IF NOT EXISTS MENU(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    RESTAURANT_ID INT,
    ITEM_NAME TEXT NOT NULL,
    DESCRIPTION TEXT NOT NULL,
    PRICE INT NOT NULL,
    IMAGE TEXT NOT NULL,
    FOREIGN KEY (RESTAURANT_ID) REFERENCES RESTAURANTS(ID))`;

const ReviewTable = `CREATE TABLE IF NOT EXISTS REVIEWS(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INT,
    RESTAURANT_ID INT,
    RATING INT,
    COMMENT TEXT,
    REPLY TEXT,
    CREATED_AT TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (RESTAURANT_ID) REFERENCES RESTAURANTS(ID))`;

const NotificationTable = `CREATE TABLE IF NOT EXISTS NOTIFICATIONS(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USER_ID INTEGER,
    MESSAGE TEXT,
    CREATED_AT TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (USER_ID) REFERENCES USERS(ID))`;

module.exports = {db, RestaurantsTable, UsersTable, ReservationTable, MenuTable, ReviewTable, NotificationTable};